# PogPool

<p align="center">
  <img src="/pog_pool_logo.png" width="400" height="400" alt="PogPool Logo"/>
</p>
**PogPool** is a super simple C library for PostgreSQL connection pooling and auto-generating basic CRUD operations from SQL table definitions. It provides a simple, fast, and dependency-free way to interact with PostgreSQL using generated C structs and functions.

## Motivation

Just wanted to make a simple SQL connection pooler, then I got carried about with autogenerating SQL into C codes. I am sure there are other codes for this, but for now this is probably fine. It is ideal for for small-scale C applications, prototyping, embedded systems, or learning projects. 

## Key Feature

* Simple connection pool for PostgreSQL using only `libpq`.
* uto-generates `INSERT`, `SELECT`, `UPDATE`, and `DELETE` C functions from SQL table schemas
* Lightweight alternative to PgBouncer/PGPool
* Naive metaprogramming that maps SQL types to C structs for rapid prototyping

## Requirements 

- gcc
- libpq

## How to get started 

If you have docker and make, I have provided a simple example for this.

```
docker-compose up
make debug && ./bin/main
```

You can update `pog_pool_config.yml` file to route to your own db or different input / output folders for your autogenerated files.

## Generic idea

1. **Define your tables** in `.sql` files with `CREATE TABLE IF NOT EXISTS` statements (I hard coded this part you because I was too lazy to create proper lexer to get table name).
2. Run `make auto_generate` to:
   * Generate `model_<TableName>.c/.h` files to defined directory in pog_pool_config.yml.
   * Create a unified `models.h` file to include them all
3. Link against `libpq` and `pog_pool` and call the generated CRUD functions in your app.
4. Connection pooling is handled via `InitPool()` / `BorrowConnection()` / `ReleaseConnection()` in `pog_pool` or you cna directly use PGConn* types.

## ðŸ“‹ TODO

* [ ] Foreign key and join-based CRUD generation
* [ ] Optional: lightweight migration/versioning support (maybe!)
